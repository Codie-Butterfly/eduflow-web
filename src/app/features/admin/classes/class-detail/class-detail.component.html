<div class="class-detail">
  @if (isLoading()) {
    <div class="loading-container">
      <mat-spinner diameter="40"></mat-spinner>
    </div>
  } @else if (schoolClass(); as cls) {
    <header class="page-header">
      <div class="header-left">
        <a mat-icon-button routerLink="/admin/classes" class="back-btn">
          <mat-icon>arrow_back</mat-icon>
        </a>
        <div class="class-header">
          <div class="class-icon">
            <mat-icon>class</mat-icon>
          </div>
          <div class="header-info">
            <h1>{{ cls.name }}</h1>
            <div class="meta">
              <mat-chip color="primary" selected>Grade {{ cls.grade }}</mat-chip>
              <span class="academic-year">{{ cls.academicYear }}</span>
              <mat-chip [color]="cls.active ? 'primary' : 'accent'" selected>
                {{ cls.active ? 'Active' : 'Inactive' }}
              </mat-chip>
            </div>
          </div>
        </div>
      </div>
      <div class="header-actions">
        <button mat-stroked-button [routerLink]="['/admin/classes', cls.id, 'edit']">
          <mat-icon>edit</mat-icon>
          Edit
        </button>
        <button mat-stroked-button color="warn" (click)="deleteClass()">
          <mat-icon>delete</mat-icon>
          Delete
        </button>
      </div>
    </header>

    <div class="content-grid">
      <div class="main-content">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Class Information</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="info-grid">
              <div class="info-item">
                <label>Class Name</label>
                <span>{{ cls.name }}</span>
              </div>
              <div class="info-item">
                <label>Grade</label>
                <span>Grade {{ cls.grade }}</span>
              </div>
              <div class="info-item">
                <label>Section</label>
                <span>{{ cls.section || 'N/A' }}</span>
              </div>
              <div class="info-item">
                <label>Academic Year</label>
                <span>{{ cls.academicYear }}</span>
              </div>
              <div class="info-item">
                <label>Capacity</label>
                <span>{{ cls.capacity || 'Unlimited' }}</span>
              </div>
              <div class="info-item">
                <label>Current Enrollment</label>
                <span>{{ cls.studentCount || 0 }} students</span>
              </div>
              @if (cls.description) {
                <div class="info-item full-width">
                  <label>Description</label>
                  <span>{{ cls.description }}</span>
                </div>
              }
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card>
          <mat-card-header>
            <mat-card-title>Enrolled Students</mat-card-title>
            <mat-card-subtitle>{{ students().length }} students enrolled</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            @if (studentsLoading()) {
              <div class="loading-container small">
                <mat-spinner diameter="30"></mat-spinner>
              </div>
            } @else if (students().length === 0) {
              <div class="empty-state">
                <mat-icon>people_outline</mat-icon>
                <p>No students enrolled in this class</p>
              </div>
            } @else {
              <table mat-table [dataSource]="students()" class="students-table">
                <ng-container matColumnDef="studentId">
                  <th mat-header-cell *matHeaderCellDef>Student ID</th>
                  <td mat-cell *matCellDef="let student">{{ student.studentId }}</td>
                </ng-container>

                <ng-container matColumnDef="name">
                  <th mat-header-cell *matHeaderCellDef>Name</th>
                  <td mat-cell *matCellDef="let student">
                    <a [routerLink]="['/admin/students', student.id]" class="student-link">
                      {{ student.fullName }}
                    </a>
                  </td>
                </ng-container>

                <ng-container matColumnDef="gender">
                  <th mat-header-cell *matHeaderCellDef>Gender</th>
                  <td mat-cell *matCellDef="let student">{{ student.gender | titlecase }}</td>
                </ng-container>

                <ng-container matColumnDef="status">
                  <th mat-header-cell *matHeaderCellDef>Status</th>
                  <td mat-cell *matCellDef="let student">
                    <mat-chip [color]="student.status === 'ACTIVE' ? 'primary' : 'accent'" selected size="small">
                      {{ student.status | lowercase }}
                    </mat-chip>
                  </td>
                </ng-container>

                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>Actions</th>
                  <td mat-cell *matCellDef="let student">
                    <button mat-icon-button color="warn" (click)="removeStudent(student)">
                      <mat-icon>person_remove</mat-icon>
                    </button>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="studentColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: studentColumns;"></tr>
              </table>
            }
          </mat-card-content>
        </mat-card>
      </div>

      <div class="sidebar">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Class Teacher</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            @if (cls.classTeacher) {
              <div class="teacher-card">
                <div class="teacher-avatar">
                  <mat-icon>person</mat-icon>
                </div>
                <div class="teacher-info">
                  <span class="name">{{ cls.classTeacher.name }}</span>
                  @if (cls.classTeacher.email) {
                    <a href="mailto:{{ cls.classTeacher.email }}" class="contact">
                      <mat-icon>email</mat-icon>
                      {{ cls.classTeacher.email }}
                    </a>
                  }
                </div>
              </div>
            } @else {
              <p class="no-data">No teacher assigned</p>
            }
          </mat-card-content>
        </mat-card>

        <mat-card>
          <mat-card-header>
            <mat-card-title>Subjects</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            @if (cls.subjects && cls.subjects.length > 0) {
              <div class="subjects-list">
                @for (subject of cls.subjects; track subject) {
                  <mat-chip>{{ subject }}</mat-chip>
                }
              </div>
            } @else {
              <p class="no-data">No subjects assigned</p>
            }
          </mat-card-content>
        </mat-card>

        <mat-card>
          <mat-card-header>
            <mat-card-title>Capacity</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="capacity-info">
              <div class="capacity-bar">
                <div class="capacity-fill" [style.width.%]="getCapacityPercentage()"></div>
              </div>
              <div class="capacity-text">
                <span>{{ cls.studentCount || 0 }} / {{ cls.capacity || 'âˆž' }}</span>
                <span class="percentage">{{ getCapacityPercentage() }}%</span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>
  }
</div>