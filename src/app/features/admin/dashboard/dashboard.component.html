<div class="dashboard">
  <header class="page-header">
    <div>
      <h1>Welcome back, {{ currentUser()?.firstName }}!</h1>
      <p class="text-secondary">Here's what's happening with your school today.</p>
    </div>
    <div class="header-actions">
      <button mat-button (click)="refreshData()" [disabled]="statsLoading() || paymentsLoading()">
        <mat-icon>refresh</mat-icon>
        Refresh
      </button>
      <button mat-raised-button color="primary" routerLink="/admin/students/new">
        <mat-icon>add</mat-icon>
        Add Student
      </button>
    </div>
  </header>

  @if (statsLoading()) {
    <div class="stats-loading">
      <mat-spinner diameter="30"></mat-spinner>
      <span>Loading statistics...</span>
    </div>
  } @else {
    <div class="stats-grid">
      <app-stat-card
        title="Total Students"
        [value]="stats().totalStudents"
        icon="school"
        color="primary">
      </app-stat-card>

      <app-stat-card
        title="Total Teachers"
        [value]="stats().totalTeachers"
        icon="person"
        color="success">
      </app-stat-card>

      <app-stat-card
        title="Fees Collected"
        [value]="stats().feesCollected"
        icon="payments"
        color="primary"
        [isCurrency]="true">
      </app-stat-card>

      <app-stat-card
        title="Outstanding Fees"
        [value]="stats().outstandingFees"
        icon="warning"
        color="warning"
        [isCurrency]="true">
      </app-stat-card>
    </div>
  }

  <div class="content-grid">
    <mat-card class="recent-payments">
      <mat-card-header>
        <mat-card-title>Recent Payments</mat-card-title>
        <button mat-button color="primary" routerLink="/admin/payments">View All</button>
      </mat-card-header>
      <mat-card-content>
        @if (paymentsLoading()) {
          <div class="loading-container">
            <mat-spinner diameter="30"></mat-spinner>
          </div>
        } @else if (recentPayments().length === 0) {
          <div class="empty-state">
            <mat-icon>payments</mat-icon>
            <p>No recent payments found</p>
          </div>
        } @else {
          <table mat-table [dataSource]="recentPayments()" class="payments-table">
            <ng-container matColumnDef="studentName">
              <th mat-header-cell *matHeaderCellDef>Student</th>
              <td mat-cell *matCellDef="let payment">
                <div class="student-info">
                  <span class="name">{{ payment.studentName }}</span>
                  @if (payment.feeName) {
                    <small class="fee-name">{{ payment.feeName }}</small>
                  }
                </div>
              </td>
            </ng-container>

            <ng-container matColumnDef="amount">
              <th mat-header-cell *matHeaderCellDef>Amount</th>
              <td mat-cell *matCellDef="let payment">{{ payment.amount | currency:'ZMW':'symbol':'1.0-0' }}</td>
            </ng-container>

            <ng-container matColumnDef="method">
              <th mat-header-cell *matHeaderCellDef>Method</th>
              <td mat-cell *matCellDef="let payment">{{ payment.method }}</td>
            </ng-container>

            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>Status</th>
              <td mat-cell *matCellDef="let payment">
                <mat-chip [color]="getStatusColor(payment.status)" selected>
                  {{ payment.status }}
                </mat-chip>
              </td>
            </ng-container>

            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef>Date</th>
              <td mat-cell *matCellDef="let payment">{{ payment.date | date:'mediumDate' }}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        }
      </mat-card-content>
    </mat-card>

    <mat-card class="quick-actions">
      <mat-card-header>
        <mat-card-title>Quick Actions</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="actions-grid">
          <button mat-stroked-button routerLink="/admin/fees/new" class="action-btn">
            <mat-icon>add_card</mat-icon>
            <span>Create Fee</span>
          </button>
          <button mat-stroked-button routerLink="/admin/fees/assign" class="action-btn">
            <mat-icon>assignment</mat-icon>
            <span>Assign Fees</span>
          </button>
          <button mat-stroked-button routerLink="/admin/reports" class="action-btn">
            <mat-icon>assessment</mat-icon>
            <span>View Reports</span>
          </button>
          <button mat-stroked-button routerLink="/admin/announcements/new" class="action-btn">
            <mat-icon>campaign</mat-icon>
            <span>Announcement</span>
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>